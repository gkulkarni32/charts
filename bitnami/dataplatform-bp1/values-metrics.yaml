
zookeeper:
  replicaCount: 3
  ## Size in MB for the Java Heap options (Xmx and XMs). This env var is ignored if Xmx an Xms are configured via JVMFLAGS
  ##
  heapSize: 4096
  resources:
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    limits: {}
    #  cpu: 250m
    #  memory: 1Gi
    requests:
      cpu: 250m
      memory: 5120Mi
  affinity: 
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - zookeeper
        topologyKey: "kubernetes.io/hostname"

## Kafka Subchart parameters
##
kafka:
  enabled: true
  replicaCount: 3
  ## Kafka's Java Heap size
  ##
  heapOpts: -Xmx4096m -Xms4096m
  resources:
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    limits: {}
    #  cpu: 250m
    #  memory: 1Gi
    requests: 
      cpu: 250m
      memory: 5120Mi
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/component
            operator: In
            values:
            - kafka
        topologyKey: "kubernetes.io/hostname"
    podAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
       - weight: 50
         podAffinityTerm:
           labelSelector:
             matchExpressions:
             - key: app.kubernetes.io/name
               operator: In
               values:
                 - zookeeper
           topologyKey: "kubernetes.io/hostname"  
  ## Prometheus Exporters / Metrics
  ##
  metrics:
    ## Prometheus Kafka Exporter: exposes complimentary metrics to JMX Exporter
    ##
    kafka:
      enabled: true
      ## Prometheus Kafka Exporter' resource requests and limits
      ## ref: http://kubernetes.io/docs/user-guide/compute-resources/
      ##
      resources:
        # We usually recommend not to specify default resources and to leave this as a conscious
        # choice for the user. This also increases chances charts run on environments with little
        # resources, such as Minikube. If you do want to specify resources, uncomment the following
        # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
        limits: {}
        #  cpu: 100m
        #  memory: 128Mi
        requests: 
          cpu: 100m
          memory: 128Mi
      ## Service configuration
      ##
      service:
        ## Kafka Exporter Prometheus port to be used in wavefront configuration
        ##
        port: 9308

    ## Prometheus JMX Exporter: exposes the majority of Kafkas metrics
    ##
    jmx:
      enabled: true
      ## Prometheus JMX Exporter' resource requests and limits
      ## ref: http://kubernetes.io/docs/user-guide/compute-resources/
      ##
      resources:
        # We usually recommend not to specify default resources and to leave this as a conscious
        # choice for the user. This also increases chances charts run on environments with little
        # resources, such as Minikube. If you do want to specify resources, uncomment the following
        # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
        limits: {}
        #  cpu: 100m
        #  memory: 128Mi
        requests: 
          cpu: 100m
          memory: 128Mi
      ## Service configuration
      ##
      service:
        ## JMX Exporter Prometheus port
        ##
        port: 5556          
  zookeeper:
    enabled: false
  ## This value is only used when zookeeper.enabled is set to false
  ##
  externalZookeeper:
    ## Server or list of external zookeeper servers to use.
    ##
    servers: {{ Release.name}}-zookeeper

## Spark Subchart parameters
##
spark:
  enabled: true
  ## Spark master specific configuration
  ##
  master:
    ## Spark container ports
    ##
    webPort: 8080  
    resources:
      # We usually recommend not to specify default resources and to leave this as a conscious
      # choice for the user. This also increases chances charts run on environments with little
      # resources, such as Minikube. If you do want to specify resources, uncomment the following
      # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
      limits: {}
      #  cpu: 250m
      #  memory: 1Gi
      requests:
        cpu: 250m
        memory: 5120Mi
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/component
              operator: In
              values:
              - worker
          topologyKey: "kubernetes.io/hostname"
  ## Spark worker specific configuration
  ##
  worker:
    replicaCount: 2
    ## Spark container ports
    ##
    webPort: 8081    
    affinity: 
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/component
              operator: In
              values:
              - worker
              - master
          topologyKey: "kubernetes.io/hostname"
    resources:
      # We usually recommend not to specify default resources and to leave this as a conscious
      # choice for the user. This also increases chances charts run on environments with little
      # resources, such as Minikube. If you do want to specify resources, uncomment the following
      # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
      limits: {}
      #  cpu: 250m
      #  memory: 1Gi
      requests: 
        cpu: 250m
        memory: 5120Mi
  ## Metrics configuration
  ##
  metrics:
    enabled: true
    ## Annotations for the Prometheus metrics on master nodes
    ##
    masterAnnotations:
      prometheus.io/scrape: 'true'
      prometheus.io/path: '/metrics/'
      prometheus.io/port: '{{ .Values.master.webPort }}'
    ## Annotations for the Prometheus metrics on worker nodes
    ##
    workerAnnotations:
      prometheus.io/scrape: 'true'
      prometheus.io/path: '/metrics/'
      prometheus.io/port: '{{ .Values.worker.webPort }}'


## Solr Subchart parameters
##
solr:
  enabled: true
  replicaCount: 2
  image: 
    registry: harbor-repo.vmware.com/dockerhub-proxy-cache
    repository: rafaelriossaavedra/solr_temp
    tag: fix_1

  ## Java memory options
  ##
  javaMem: -Xmx4096m -Xms4096m
  ## java Heap options
  ##
  # heap: -Xmx4096m -Xms4096m  
  affinity: 
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/component
            operator: In
            values:
            - solr
        topologyKey: "kubernetes.io/hostname"   
  resources:
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    limits: {}
    #  cpu: 1000m
    #  memory: 1Gi
    requests:
      cpu: 250m
      memory: 5120Mi
  # Configuration for the solr prometheus exporter
  exporter:
    enabled: true  # Deploy the exporter
    ## Solr exporter port
    ##
    port: 9983    
    affinity:
      podAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
         - weight: 50
           podAffinityTerm:
             labelSelector:
               matchExpressions:
               - key: app.kubernetes.io/name
                 operator: In
                 values:
                   - solr
             topologyKey: "kubernetes.io/hostname"     
    resources:
      # We usually recommend not to specify default resources and to leave this as a conscious
      # choice for the user. This also increases chances charts run on environments with little
      # resources, such as Minikube. If you do want to specify resources, uncomment the following
      # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
      limits: {}
      #  cpu: 1000m
      #  memory: 1Gi
      requests:
        cpu: 100m
        memory: 128Mi              
  zookeeper:
    enabled: false
  ## This value is only used when zookeeper.enabled is set to false
  ##
  externalZookeeper:
    ## Server or list of external zookeeper servers to use.
    ##
    servers: {{ Release.name}}-zookeeper

## Wavefront Subchart parameters
##
wavefront:
  enabled: true
  ## This is a unique name for the cluster (required)
  ## All metrics will receive a `cluster` tag with this value
  ##
  clusterName: data-platform-tkc
  ## Wavefront URL (cluster) and API Token (required)
  ##
  wavefront:
    url: https://longboard.wavefront.com #$WAVEFRONT_URL

    ## Name of an existing secret containing the token
    ##
    existingSecret: wavefront-token
  ## Wavefront Collector is responsible to get all Kubernetes metrics from your cluster.
  ## It will capture Kubernetes resources metrics available from the kubelets,
  ## as well as auto-discovery capabilities.
  ##
  collector:
  ## Rules based discovery configuration
  ## Ref: https://github.com/wavefrontHQ/wavefront-kubernetes-collector/blob/master/docs/discovery.md
  ##
    resources:
      # We usually recommend not to specify default resources and to leave this as a conscious
      # choice for the user. This also increases chances charts run on environments with little
      # resources, such as Minikube. If you do want to specify resources, uncomment the following
      # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
      limits: {}
      #  cpu: 200m
      #  memory: 256Mi
      requests: 
        cpu: 200m
        memory: 10Mi  
    discovery:
      enabled: true
      ## Whether to enable runtime discovery configurations
      ## Ref: https://github.com/wavefrontHQ/wavefront-collector-for-kubernetes/blob/master/docs/discovery.md#runtime-configurations
      ##
      enableRuntimeConfigs: true
      ## Can be used to add additional discovery rules
      ##
      config:
      # auto-discover a sample prometheus application
      # auto-discover kafka-exporter
      - name: kafka-discovery
        type: prometheus
        selectors:
          images:
          - '*bitnami/kafka-exporter*'
          #labels:
          #  k8s-app:
          #  - kube-dns
        port: 9308
        path: /metrics
        scheme: http
        prefix: kube.kafka.

      # auto-discover jmx exporter 
      - name: kafka-jmx-discovery
        type: prometheus
        selectors:
          images:
          - '*bitnami/jmx-exporter*'
          #labels:
            #k8s-app:
            #- kube-dns
        port: 5556
        path: /metrics
        scheme: http
        prefix: kube.kafkajmx.

      # auto-discover solr
      - name: solr-discovery
        type: prometheus
        selectors:
          images:
          - '*bitnami/solr*'
          #labels:
            #k8s-app:
            #- kube-dns
        port: 9983
        path: /metrics
        scheme: http
        prefix: kube.solr.

      # auto-discover spark
      - name: spark-worker-discovery
        type: prometheus
        selectors:
          images:
          - '*bitnami/spark*'
          #labels:
            #k8s-app:
            #- kube-dns
        port: 8081
        path: /metrics/
        scheme: http
        prefix: kube.spark.

      # auto-discover spark
      - name: spark-master-discovery
        type: prometheus
        selectors:
          images:
          - '*bitnami/spark*'
          #labels:
            #k8s-app:
            #- kube-dns
        port: 8080
        path: /metrics/
        scheme: http
        prefix: kube.spark.
  proxy:
    ## Wavefront Proxy resource requests and limits
    ## ref: http://kubernetes.io/docs/user-guide/compute-resources/
    ##
    resources:
      # We usually recommend not to specify default resources and to leave this as a conscious
      # choice for the user. This also increases chances charts run on environments with little
      # resources, such as Minikube. If you do want to specify resources, uncomment the following
      # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
      limits: {}
      #  cpu: 100m
      #  memory: 4Gi
      requests: 
        cpu: 100m
        memory: 5Gi
